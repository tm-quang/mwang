<!DOCTYPE html>
<html>
<head>
    </head>
<body>
    <div class="search-container">
        </div>
    <div class="result-wrapper">
        </div>

<script>
    // ... các biến DOM ...
  
    async function searchTimHangBK() {
        const maKho = document.getElementById('maKhoSelect').value;
        const maUser = document.getElementById('maUserInput').value.trim();

        // ... xử lý lỗi input trống ...
        if (!maKho || !maUser) { return; }

        // ... hiển thị loading ...
        searchButton.disabled = true;

        const token = localStorage.getItem('userToken');
        if (!token) {
            alert("Lỗi xác thực. Vui lòng đăng nhập lại.");
            return;
        }

        try {
            const response = await fetch('/api/search-backup-stock', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ maKho, maUser })
            });
            
            if (response.status === 401) { throw new Error('Phiên đã hết hạn'); }
            if (!response.ok) { throw new Error('Lỗi máy chủ'); }

            const results = await response.json();
            
            if (results && results.length > 0) {
                resultTableBody.innerHTML = '';
                results.forEach(rowData => {
                    const row = resultTableBody.insertRow();
                    // ... điền dữ liệu vào bảng ...
                });
                resultTableContainer.style.display = 'block';
            } else {
                noResultsMessage.style.display = 'block';
            }

        } catch (error) {
            errorMessage.textContent = 'Lỗi: ' + error.message;
        } finally {
            // ... ẩn loading ...
            searchButton.disabled = false;
        }
    }

    // ... các hàm khác như clearSearch giữ nguyên ...
</script>
</body>
</html>