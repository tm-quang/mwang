<!DOCTYPE html>
<html lang="vi">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Quản lý Công việc</title>
    <!-- Thư viện Font Awesome cho các biểu tượng (icon) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Thư viện Google Fonts cho font chữ Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* ================================================================= */
        /* PHẦN CSS - GIỮ NGUYÊN HOÀN TOÀN TỪ FILE MẪU CỦA BẠN             */
        /* ================================================================= */
        :root {
            --primary-color: #0056b3;
            --primary-hover: #4338ca;
            --danger-color: #ef4444;
            --danger-hover: #dc2626;
            --success-color: #22c55e;
            --warning-color: #f97316;
            --bg-main: #f9fafb; /* Thay đổi nền chính cho sáng hơn một chút */
            --bg-content: #ffffff;
            --bg-sidebar-left: #111827;
            --bg-sidebar-right: #f3f4f6;
            --bg-modal-overlay: rgba(17, 24, 39, 0.6);
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-on-dark: #e5e7eb;
            --text-on-dark-hover: #ffffff;
            --text-on-primary: #ffffff;
            --border-color: #e5e7eb;
            --divider-color-dark: #374151;
            --border-radius-sm: 0.25rem;
            --border-radius-md: 0.375rem;
            --border-radius-lg: 0.5rem;
            --border-radius-full: 9999px;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body { margin: 0; padding: 0; font-family: var(--font-family); background-color: var(--bg-main); color: var(--text-primary); display: flex; flex-direction: column; height: 100vh; overflow: hidden; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }

        /* Header */
        #main-header { background-color: #0056b3; color: white; padding: 12px 24px; display: flex; justify-content: space-between; align-items: center; box-shadow: var(--shadow-sm); border-bottom: 1px solid var(--border-color); flex-shrink: 0; z-index: 10; }
        #header-left { font-size: 1rem; font-weight: 500; }
        #header-left span { cursor: pointer; display: flex; align-items: center; gap: 8px; color: white; transition: color 0.2s ease; }
        #header-left span:hover { color: #e5e7eb; }
        #header-left .header-icon { font-size: 1.1rem; }
        #current-page-title { font-size: 1.1rem; font-weight: 500; flex-grow: 1; text-align: center; }
        #header-right { display: flex; align-items: center; gap: 20px; }
        .header-item { white-space: nowrap; }
        #user-controls { display: flex; align-items: center; gap: 12px; }
        .greeting-text { color: white; margin-right: 10px; font-weight: 500; }
        .header-logout-btn { background-color: var(--success-color); color: var(--text-on-primary); border: 1px solid var(--success-color); padding: 6px 12px; border-radius: var(--border-radius-md); cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: all 0.2s ease; }
        .header-logout-btn:hover { background-color: var(--danger-color); border-color: var(--danger-color); }
        #session-timer-container { display: flex; align-items: center; margin-left: 20px; font-size: 0.9rem; }
        #live-clock { font-size: 0.9rem; font-weight: 500; text-align: right; min-width: 150px; }
        #live-clock #clock-time { display: block; font-weight: 1000; }
        #live-clock #clock-date { display: block; font-size: 0.8rem; }
        
        /* Main Content Area */
        #main-content-area { display: flex; flex-grow: 1; overflow: hidden; }
        #content-container { flex-grow: 1; padding: 24px; display: flex; flex-direction: column; overflow-y: auto; box-sizing: border-box; }
        #functionContent { width: 100%; flex-grow: 1; }
        #loadingSpinner { border: 4px solid var(--border-color); border-top: 4px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 50px auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Left Sidebar */
        #left-sidebar-container { width: 280px; background-color: var(--bg-sidebar-left); color: var(--text-on-dark); padding: 16px; box-shadow: var(--shadow-md); flex-shrink: 0; flex-direction: column; box-sizing: border-box; overflow-y: auto; transition: width 0.3s ease, padding 0.3s ease; position: relative; z-index: 5; }
        #left-sidebar-container::-webkit-scrollbar { width: 6px; }
        #left-sidebar-container::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        #left-sidebar-container.collapsed { width: 72px; padding: 16px 0; }
        #left-sidebar-container.collapsed .menu-button-sidebar span, #left-sidebar-container.collapsed .dropdown-button span, #left-sidebar-container.collapsed .menu-section-title span, #left-sidebar-container.collapsed .dropdown-arrow { opacity: 0; width: 0; height: 0; padding: 0; margin: 0; overflow: hidden; pointer-events: none; transition: all 0.2s ease; }
        #left-sidebar-container.collapsed .menu-button-sidebar, #left-sidebar-container.collapsed .dropdown-button { justify-content: center; width: 44px; margin-left: auto; margin-right: auto; }
        #left-sidebar-container.collapsed .menu-button-sidebar .icon, #left-sidebar-container.collapsed .dropdown-button .icon { margin-right: 0; font-size: 1.2rem; }
        #left-sidebar-container.collapsed .menu-section-title { padding: 0; height: auto; margin-bottom: 10px; }
        #left-sidebar-container.collapsed .menu-section { border-bottom: none; }
        .sidebar-content-wrapper { width: 100%; display: flex; flex-direction: column; align-items: center; flex-grow: 1; }
        .menu-section { width: 100%; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid var(--divider-color-dark); }
        .menu-section:last-of-type { border-bottom: none; }
        .menu-section-title { color: #9ca3af; text-align: left; margin-bottom: 8px; font-size: 0.8rem; font-weight: 600; padding: 8px 12px; width: 100%; display: flex; align-items: center; box-sizing: border-box; text-transform: uppercase; letter-spacing: 0.05em; }
        .menu-button-sidebar, .dropdown-button { background-color: transparent; color: var(--text-on-dark); padding: 10px 12px; margin-bottom: 4px; border: none; border-radius: var(--border-radius-md); cursor: pointer; width: 100%; font-size: 0.9rem; font-weight: 500; text-align: left; text-decoration: none; display: flex; justify-content: flex-start; align-items: center; transition: background-color 0.2s ease, color 0.2s ease; box-sizing: border-box;}
        .menu-button-sidebar:hover, .dropdown-button:hover, .dropdown-button.active { background-color: #374151; color: var(--text-on-dark-hover); }
        .menu-button-sidebar .icon, .dropdown-button .icon { margin-right: 12px; font-size: 1rem; min-width: 20px; text-align: center; color: #9ca3af; transition: color 0.2s ease; }
        .menu-button-sidebar:hover .icon, .dropdown-button:hover .icon, .dropdown-button.active .icon { color: var(--text-on-dark-hover); }
        .dropdown { position: relative; width: 100%;}
        .dropdown-button { align-items: left; }
        .dropdown-menu { display: none; position: fixed; min-width: 230px; z-index: 1001; background-color: #1f2937; border-radius: var(--border-radius-lg); padding: 6px; flex-direction: column; box-shadow: var(--shadow-lg); border: 1px solid var(--divider-color-dark); }
        .dropdown-menu.show { display: flex; }
        .dropdown-menu .menu-button-sidebar { width: 100%; box-sizing: border-box; }
        .dropdown-menu .menu-button-sidebar:hover { background-color: #4b5563; }

        /* Right Sidebar */
        #right-sidebar-container { width: 250px; background-color: var(--bg-sidebar-right); color: var(--text-primary); padding: 16px; border-left: 1px solid var(--border-color); flex-shrink: 0; display: flex; flex-direction: column; align-items: center; box-sizing: border-box; overflow-y: auto; transition: width 0.3s ease, padding 0.3s ease; position: relative; }
        #right-sidebar-container.collapsed { width: 100px; padding: 16px 0; }
        #right-sidebar-container.collapsed h3, #right-sidebar-container.collapsed .link-button-right span { opacity: 0; width: 0; height: 0; padding: 0; margin: 0; overflow: hidden; pointer-events: none; transition: all 0.2s ease; }
        #right-sidebar-container.collapsed .link-button-right { width: 50px; justify-content: center; margin-left: auto; margin-right: auto; }
        #right-sidebar-container.collapsed .link-button-right .icon { margin: 0; font-size: 1.1rem; }
        #right-sidebar-container.collapsed .right-menu-section { margin-bottom: 10px; }
        #right-sidebar-container.collapsed h3 { height: auto; margin-bottom: 10px; }
        #right-sidebar-container h3 { color: var(--text-secondary); text-align: center; margin-bottom: 16px; font-size: 0.8rem; font-weight: 600; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; text-transform: uppercase; }
        .right-menu-section { width: 100%; display: flex; flex-direction: column; align-items: center; margin-bottom: 16px; }
        .link-button-right { background-color: var(--bg-content); color: var(--text-secondary); padding: 8px 12px; margin-bottom: 8px; border: 1px solid var(--border-color); border-radius: var(--border-radius-md); cursor: pointer; width: 85%; font-size: 0.9rem; font-weight: 500; text-decoration: none; display: flex; align-items: center; justify-content: flex-start; transition: all 0.2s ease; box-shadow: var(--shadow-sm); }
        .link-button-right:hover { background-color: #e5e7eb; color: var(--text-primary); border-color: #d1d5db; }
        .link-button-right .icon { margin-right: 10px; font-size: 0.9rem; min-width: 16px; text-align: center; }
        .link-button-right.primary { border-color: var(--primary-color); color: var(--primary-color); }
        .link-button-right.primary:hover { background-color: var(--primary-color); color: var(--text-on-primary); }
        .link-button-right.success { border-color: var(--success-color); color: var(--success-color); }
        .link-button-right.success:hover { background-color: var(--success-color); color: var(--text-on-primary); }
        .link-button-right.info { border-color: #0ea5e9; color: #0ea5e9; }
        .link-button-right.info:hover { background-color: #0ea5e9; color: var(--text-on-primary); }
        
        /* Modals */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-modal-overlay); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background-color: var(--bg-content); padding: 25px 30px; border-radius: var(--border-radius-lg); box-shadow: var(--shadow-lg); text-align: center; max-width: 400px; width: 90%; animation: fadeInScale 0.3s ease-out; }
        .modal-content p { font-size: 1.1rem; margin: 0 0 20px 0; color: var(--text-primary); }
        .modal-buttons { display: flex; justify-content: center; gap: 12px; }
        .modal-buttons button { padding: 10px 25px; border: none; border-radius: var(--border-radius-md); cursor: pointer; font-size: 1rem; font-weight: 600; transition: background-color 0.2s; }
        #confirmBtnYes, #adminLoginSubmit { background-color: var(--primary-color); color: white; }
        #confirmBtnYes:hover, #adminLoginSubmit:hover { background-color: var(--primary-hover); }
        #confirmBtnNo, #adminLoginCancel { background-color: #e0e0e0; color: #333; }
        #confirmBtnNo:hover, #adminLoginCancel:hover { background-color: #c7c7c7; }
        @keyframes fadeInScale { from { opacity: 0; transform: translateY(10px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
        
        /* Floating Button & Popups */
        .floating-button { position: fixed; bottom: 20px; right: 20px; background-color: var(--success-color); color: var(--text-on-primary); padding: 12px; border: none; border-radius: var(--border-radius-full); cursor: pointer; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-lg); z-index: 999; transition: all 0.3s ease; }
        .floating-button:hover { transform: translateY(-3px) scale(1.05); }
        .floating-button .icon { font-size: 1.5rem; }
        .popup-container { position: fixed; bottom: 85px; right: 20px; width: 320px; background-color: var(--bg-content); border-radius: var(--border-radius-lg); box-shadow: var(--shadow-lg); z-index: 1000; display: none; flex-direction: column; overflow: hidden; animation: fadeInScale 0.3s ease-out; }
        .popup-container.show { display: flex; }
        .popup-header { background-color: var(--primary-color); color: var(--text-on-primary); padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; }
        .popup-header h3 { margin: 0; font-size: 1.1rem; font-weight: 600; }
        .close-popup-button { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; opacity: 0.8; transition: opacity 0.2s ease; }
        .close-popup-button:hover { opacity: 1; }
        .popup-content { padding: 16px; color: var(--text-primary); font-size: 0.9rem; }
        .popup-content p { margin: 0 0 12px 0; display: flex; align-items: center; gap: 10px; }
        .popup-content p:last-child { margin-bottom: 0; }
        .popup-content .fas, .popup-content .fab { color: var(--primary-color); font-size: 1rem; }
        .popup-content a { color: var(--primary-color); text-decoration: none; font-weight: 500; }
        .popup-content a:hover { text-decoration: underline; }

        /* Notification Styles */
        .columns-container { display: flex; flex-direction: row; gap: 24px; width: 100%; }
        .content-column { flex: 1; min-width: 0; display: flex; flex-direction: column; }
        .column-title { font-size: 1.1rem; font-weight: 600; color: #c00000; padding-bottom: 8px; margin-bottom: 16px; border-bottom: 2px solid var(--border-color); display: flex; align-items: center; gap: 10px; }
        .notification-list { display: flex; flex-direction: column; gap: 16px; }
        .notification-card { background-color: #f3f4f6; border: 1px solid #d1d5db; border-radius: var(--border-radius-lg); padding: 16px; box-shadow: var(--shadow-sm); display: flex; flex-direction: column; transition: transform 0.2s, box-shadow 0.2s; }
        .notification-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }
        .notification-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .notification-header .icon { font-size: 1.3rem; color: var(--text-secondary); }
        .notification-header h4 { margin: 0; font-size: 1rem; font-weight: 600; flex-grow: 1; color: var(--text-primary);}
        .new-badge { background-color: #ef4444; color: white; padding: 3px 8px; font-size: 0.7rem; font-weight: 700; border-radius: var(--border-radius-full); text-transform: uppercase; animation: blink-animation 1.2s infinite; }
        .type-badge { padding: 4px 10px; border-radius: var(--border-radius-md); font-size: 0.8rem; font-weight: 500; color: #000; margin-left: auto; }
        .type-báchhóaxanh { background-color: #90ee90; }
        .type-tgdđ-đmx { background-color: #ffd700; }
        @keyframes blink-animation { 50% { opacity: 0.4; } }
        /* Responsive */
        @media (max-width: 1024px) {
            .columns-container { flex-direction: column; }
        }
        @media (max-width: 768px) {
            #left-sidebar-container { position: fixed; left: -100%; transition: left 0.3s ease; }
            #left-sidebar-container.open { left: 0; }
            #right-sidebar-container { display: none; }
            #main-header { padding: 12px 16px; }
            #content-container { padding: 16px; }
        }
    </style>
</head>
<body>
    <div id="main-header">
        <div id="header-left">
            <span id="btnGoHomeHeader"><i class="fas fa-home header-icon"></i>Trang Chủ</span>
        </div>
        <div id="current-page-title">TRANG CHỦ - THÔNG BÁO</div>
        <div id="header-right">
            <div id="user-controls" class="header-item">
                <span class="greeting-text">Xin chào</span>
                <button id="logoutButton" class="header-logout-btn">Đăng xuất</button>
            </div>
            <div id="session-timer-container" class="header-item">
                <i class="fas fa-stopwatch" style="margin-right: 5px; color: white;"></i>
                <span id="session-timer" style="color: white; font-weight: 700;">60:00</span>
            </div>
            <div id="live-clock" class="header-item">
                <span id="clock-time"></span>
                <span id="clock-date"></span>
            </div>
        </div>
    </div>

    <div id="main-content-area">
        <div id="left-sidebar-container" class="collapsed">
            <div class="sidebar-content-wrapper"></div>
        </div>
        
        <div id="content-container">
            <div id="loadingSpinner" style="display: none;"></div>
            <div id="functionContent">
                <!-- NỘI DUNG TRANG CHỦ ĐƯỢC THÊM TRỰC TIẾP VÀO ĐÂY -->
                <div class="columns-container">
                    <!-- Cột 1: Thông báo công việc triển khai -->
                    <div class="content-column">
                        <h3 class="column-title"><i class="fas fa-bullhorn"></i><span>THÔNG BÁO CÔNG VIỆC TRIỂN KHAI</span></h3>
                        <div class="notification-list">
                            <div class="notification-card">
                                <div class="notification-header">
                                    <i class="fas fa-wrench icon"></i>
                                    <h4>TRIỂN KHAI TỐI ƯU THIẾT BỊ BHX</h4>
                                    <span class="type-badge type-báchhóaxanh">BáchHóaXanh</span>
                                    <span class="new-badge">NEW</span>
                                </div>
                            </div>
                            <div class="notification-card">
                                <div class="notification-header">
                                    <i class="fas fa-file-alt icon"></i>
                                    <h4>FORM CẬP NHẬT TIẾN ĐỘ</h4>
                                    <span class="type-badge type-báchhóaxanh">BáchHóaXanh</span>
                                    <span class="new-badge">NEW</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Cột 2: Thông báo công việc MTAY2 -->
                    <div class="content-column">
                        <h3 class="column-title"><i class="fas fa-tasks"></i><span>THÔNG BÁO CÔNG VIỆC MTAY2</span></h3>
                        <div class="notification-list">
                            <div class="notification-card">
                                <div class="notification-header">
                                    <i class="fas fa-calendar-alt icon"></i>
                                    <h4>LỊCH - LAYOUT TỐI ƯU THIẾT BỊ</h4>
                                    <span class="type-badge type-báchhóaxanh">BáchHóaXanh</span>
                                    <span class="new-badge">NEW</span>
                                </div>
                            </div>
                            <div class="notification-card">
                                <div class="notification-header">
                                    <i class="fas fa-vial icon"></i>
                                    <h4>TEST</h4>
                                    <span class="type-badge type-tgdđ-đmx">TGDD/DMX</span>
                                    <span class="new-badge">NEW</span>
                                </div>
                            </div>
                             <div class="notification-card">
                                <div class="notification-header">
                                    <i class="fas fa-bell icon"></i>
                                    <h4>LỊCH BẢO TRÌ KIỂM KÊ</h4>
                                    <span class="new-badge">NEW</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="right-sidebar-container" class="collapsed">
            <div class="sidebar-content-wrapper"></div>
        </div>
    </div>

    <!-- CÁC THÀNH PHẦN PHỤ -->
    <button id="supportContactButton" class="floating-button">
        <i class="fas fa-headset icon"></i>
    </button>
    <div id="supportContactPopup" class="popup-container">
        <div class="popup-header">
            <h3>Hỗ Trợ</h3>
            <button class="close-popup-button" id="closeSupportPopup">×</button>
        </div>
        <div class="popup-content">
            <p><i class="fas fa-phone-alt"></i> Điện thoại: 0933 960 788</p>
            <p><i class="fas fa-envelope"></i> Email: minhquang030@gmail.com</p>
            <p><i class="fab fa-facebook-messenger"></i> Messenger: <a href="https://www.facebook.com/minh.quang093" target="_blank">Inbox tại đây</a></p>
        </div>
    </div>

    <div id="customConfirmModal" class="modal-overlay">
        <div class="modal-content">
            <p id="modalMessage">Bạn có chắc chắn muốn đăng xuất?</p>
            <div class="modal-buttons">
                <button id="confirmBtnYes">OK</button>
                <button id="confirmBtnNo">Cancel</button>
            </div>
        </div>
    </div>

    <div id="adminLoginModal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-top: 0; color: var(--danger-color);">Đăng nhập Quản trị</h3>
            <p id="adminLoginError" style="color: var(--danger-color); margin-bottom: 10px; height: 1em;"></p>
            <input type="text" id="adminUsername" placeholder="Tên đăng nhập" autocomplete="off" style="width: 90%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: var(--border-radius-md);">
            <input type="password" id="adminPassword" placeholder="Mật khẩu" style="width: 90%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: var(--border-radius-md);">
            <div class="modal-buttons">
                <button id="adminLoginSubmit">Đăng nhập</button>
                <button id="adminLoginCancel">Hủy</button>
            </div>
        </div>
    </div>

    <script>
    // =================================================================================
    // PHẦN JAVASCRIPT - ĐÃ TÁI CẤU TRÚC CHO GITHUB PAGES
    // =================================================================================
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- DỮ LIỆU MENU (GIỮ NGUYÊN) ---
        const leftMenuData = [
            {
                title: 'ADMIN',
                items: [
                  { id: 'btnADMIN', text: 'QUẢN TRỊ HỆ THỐNG', icon: 'fa-solid fa-sliders', isDropdown: true, isAdmin: true, 
                    subItems: [
                        { id: 'btnDatabase', text: 'DATABASE', pageUrl: '#', pageTitle: 'QUẢN LÝ DỮ LIỆU', icon: 'fa-solid fa-database' },
                        { id: 'btnUserInfo', text: 'QUẢN LÝ USER', pageUrl: '#', pageTitle: 'QUẢN LÝ THÀNH VIÊN', icon: 'fa-solid fa-users' },
                        { id: 'btnThongBao', text: 'TẠO THÔNG BÁO MỚI', pageUrl: '#', pageTitle: 'TẠO THÔNG BÁO MỚI', icon: 'fa-regular fa-newspaper' },
                    ]
                  }
                ]
            },
            {
                title: '2025 - IT MTAY2',
                items: [
                    { id: 'btnWorkLeader', text: 'TRIỂN KHAI IT MTAY2', icon: 'fas fa-laptop-code', isDropdown: true, 
                      subItems: [ { id: 'btnDeployMTay2', text: 'TRIỂN KHAI MIỀN TÂY 2', pageUrl: '#', pageTitle: 'TRIỂN KHAI MIỀN TÂY 2', icon: 'fas fa-map-marked-alt' } ] 
                    },
                    { id: 'btnBTKK', text: 'LỊCH BẢO TRÌ - KIỂM KÊ', pageUrl: '#', pageTitle: 'LỊCH BẢO TRÌ - KIỂM KÊ', icon: 'fas fa-tools' },
                ]
            }
            // Thêm các mục menu khác tại đây
        ];
        
        const rightMenuData = [
            {
                title: "TRANG CÔNG VIỆC",
                icon: "fas fa-briefcase",
                items: [
                    { text: "Báo cáo nội bộ", href: "https://baocaonoibo.com", icon: "fas fa-chart-bar", className: "primary" },
                    { text: "New Ticket", href: "https://newticket.tgdd.vn/ticket", icon: "fas fa-ticket-alt", className: "success" },
                ]
            },
            {
                title: "GIẢI TRÍ",
                icon: "fas fa-gamepad",
                items: [
                    { text: "YouTube", href: "https://youtube.com", icon: "fab fa-youtube" },
                    { text: "Facebook", href: "https://facebook.com", icon: "fab fa-facebook" },
                ]
            }
        ];

        // --- CÁC BIẾN VÀ DOM ELEMENTS ---
        const functionContent = document.getElementById('functionContent');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const currentPageTitle = document.getElementById('current-page-title');
        const leftSidebarContainer = document.getElementById('left-sidebar-container');
        const rightSidebarContainer = document.getElementById('right-sidebar-container');
        const leftSidebarContentWrapper = leftSidebarContainer.querySelector('.sidebar-content-wrapper');
        const rightSidebarContentWrapper = rightSidebarContainer.querySelector('.sidebar-content-wrapper');
        const homePageContent = functionContent.innerHTML; // Lưu lại nội dung trang chủ
        
        // Modals
        const customConfirmModal = document.getElementById('customConfirmModal');
        const adminLoginModal = document.getElementById('adminLoginModal');
        const adminUsername = document.getElementById('adminUsername');
        const adminPassword = document.getElementById('adminPassword');
        const adminLoginError = document.getElementById('adminLoginError');
        const adminLoginSubmit = document.getElementById('adminLoginSubmit');
        const adminLoginCancel = document.getElementById('adminLoginCancel');
        
        // State & Timers
        let dropdownTimeout;
        let leftSidebarTimeout;
        let rightSidebarTimeout;
        const HIDE_DELAY = 300;
        let isAdminAuthenticated = false; // Trạng thái đăng nhập Admin (mô phỏng)

        // --- CÁC HÀM XỬ LÝ CHÍNH (ĐÃ CHỈNH SỬA) ---

        /**
         * Tải nội dung trang chủ hoặc hiển thị thông báo cho các trang khác.
         * THAY THẾ cho hàm loadFunctionContent cũ.
         */
        function loadContent(pageTitle) {
            hideAllDropdowns();
            collapseSidebar(leftSidebarContainer);
            
            // Xóa nội dung hiện tại và hiển thị spinner
            functionContent.innerHTML = '';
            loadingSpinner.style.display = 'block';
            currentPageTitle.textContent = pageTitle;
            
            // Giả lập thời gian tải
            setTimeout(() => {
                loadingSpinner.style.display = 'none';
                if (pageTitle === 'TRANG CHỦ - THÔNG BÁO') {
                    // Nếu là trang chủ, tải lại nội dung đã lưu
                    functionContent.innerHTML = homePageContent;
                } else {
                    // Nếu là các trang khác, hiển thị thông báo
                    functionContent.innerHTML = `
                        <div style="text-align: center; padding: 50px; color: var(--text-secondary);">
                            <i class="fas fa-info-circle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h2>Trang "${pageTitle}"</h2>
                            <p>Nội dung cho trang này sẽ được tạo ở các bước tiếp theo.</p>
                        </div>`;
                }
            }, 300); // 0.3 giây
        }

        /**
         * Hàm vẽ menu bên trái. Đã chỉnh sửa để xử lý sự kiện click khác đi.
         */
        function renderLeftMenu() {
            leftSidebarContentWrapper.innerHTML = '';
            leftMenuData.forEach((section) => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'menu-section';
                sectionDiv.innerHTML = `<h3 class="menu-section-title"><span>${section.title}</span></h3>`;
                const menuItemsContainer = document.createElement('div');
                
                section.items.forEach(item => {
                    const createMenuButton = (menuItem, isSubItem = false) => {
                        const button = document.createElement('a');
                        button.href = menuItem.pageUrl || '#';
                        button.id = menuItem.id;
                        button.className = `menu-button-sidebar`;
                        button.innerHTML = `<i class="${menuItem.icon} icon"></i><span>${menuItem.text}</span>`;
                        
                        button.addEventListener('click', (e) => {
                            e.preventDefault(); // Ngăn chuyển trang ngay lập tức
                            loadContent(menuItem.pageTitle);
                        });

                        return button;
                    };

                    if (item.isDropdown) {
                        const dropdownDiv = document.createElement('div');
                        dropdownDiv.className = 'dropdown';
                        
                        const dropdownButton = document.createElement('div');
                        dropdownButton.className = 'dropdown-button';
                        dropdownButton.innerHTML = `<i class="${item.icon} icon"></i><span>${item.text}</span>`;
                        
                        const dropdownMenu = document.createElement('div');
                        dropdownMenu.className = 'dropdown-menu';
                        
                        item.subItems.forEach(subItem => {
                            const subLink = createMenuButton(subItem, true);
                            dropdownMenu.appendChild(subLink);
                        });
                        
                        dropdownDiv.appendChild(dropdownButton);
                        dropdownDiv.appendChild(dropdownMenu);
                        menuItemsContainer.appendChild(dropdownDiv);

                        const showMenu = () => {
                            clearTimeout(dropdownTimeout);
                            hideAllDropdowns();
                            const rect = dropdownButton.getBoundingClientRect();
                            const sidebarRect = leftSidebarContainer.getBoundingClientRect();
                            dropdownMenu.style.top = rect.top + 'px';
                            dropdownMenu.style.left = (sidebarRect.right + 5) + 'px';
                            dropdownMenu.classList.add('show');
                            dropdownButton.classList.add('active');
                        };

                        const hideMenu = () => {
                            dropdownTimeout = setTimeout(() => {
                                dropdownMenu.classList.remove('show');
                                dropdownButton.classList.remove('active');
                            }, HIDE_DELAY);
                        };
                        
                        // Xử lý đăng nhập cho menu Admin
                        if (item.isAdmin) {
                            dropdownButton.style.cursor = 'pointer';
                            dropdownButton.addEventListener('click', () => {
                                if (isAdminAuthenticated) {
                                    showMenu();
                                } else {
                                    hideAllDropdowns();
                                    adminLoginError.textContent = '';
                                    adminLoginModal.style.display = 'flex';
                                    adminUsername.focus();
                                }
                            });
                             dropdownDiv.onmouseleave = hideMenu;
                             dropdownMenu.onmouseenter = () => clearTimeout(dropdownTimeout);
                        } else {
                            dropdownButton.onmouseenter = showMenu;
                            dropdownButton.onmouseleave = hideMenu;
                            dropdownMenu.onmouseenter = () => clearTimeout(dropdownTimeout);
                            dropdownMenu.onmouseleave = hideMenu;
                        }

                    } else {
                        menuItemsContainer.appendChild(createMenuButton(item));
                    }
                });
                sectionDiv.appendChild(menuItemsContainer);
                leftSidebarContentWrapper.appendChild(sectionDiv);
            });
        }
        
        /**
         * Hàm vẽ menu bên phải (Giữ nguyên)
         */
        function renderRightMenu() {
            rightSidebarContentWrapper.innerHTML = '';
            rightMenuData.forEach(section => {
                const title = document.createElement('h3');
                title.innerHTML = `<i class="${section.icon}"></i><span>${section.title}</span>`;
                const menuSection = document.createElement('div');
                menuSection.className = 'right-menu-section';
                section.items.forEach(item => {
                    const link = document.createElement('a');
                    link.href = item.href;
                    link.target = '_blank';
                    link.className = `link-button-right ${item.className || ''}`;
                    link.innerHTML = `<i class="${item.icon} icon"></i><span>${item.text}</span>`;
                    menuSection.appendChild(link);
                });
                rightSidebarContentWrapper.appendChild(title);
                rightSidebarContentWrapper.appendChild(menuSection);
            });
        }
        
        /**
         * Xử lý đăng nhập Admin (Mô phỏng, không bảo mật)
         */
        function handleAdminLogin() {
            // --!> CẢNH BÁO BẢO MẬT: KHÔNG BAO GIỜ DÙNG CÁCH NÀY TRONG THỰC TẾ <--!
            // Đây chỉ là mô phỏng. Thông tin đăng nhập không nên được lưu ở phía client.
            const MOCK_USER = "admin";
            const MOCK_PASS = "12345";
            
            const username = adminUsername.value.trim();
            const password = adminPassword.value;
            
            if (username === MOCK_USER && password === MOCK_PASS) {
                isAdminAuthenticated = true;
                adminLoginModal.style.display = 'none';
                adminUsername.value = '';
                adminPassword.value = '';
                // Tự động mở menu admin sau khi đăng nhập thành công
                 document.querySelector('.dropdown-button', document.getElementById('btnADMIN')).dispatchEvent(new MouseEvent('click'));
            } else {
                isAdminAuthenticated = false;
                adminLoginError.textContent = 'Tên đăng nhập hoặc mật khẩu không đúng.';
                adminPassword.value = '';
                adminUsername.focus();
            }
        }


        // --- CÁC HÀM TIỆN ÍCH (GIỮ NGUYÊN) ---
        function collapseSidebar(sidebarElement) { sidebarElement.classList.add('collapsed'); hideAllDropdowns(); }
        function expandSidebar(sidebarElement) { sidebarElement.classList.remove('collapsed'); }
        function hideAllDropdowns() {
            document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                menu.classList.remove('show');
                menu.previousElementSibling?.classList.remove('active');
            });
        }

        function updateClock() {
            const now = new Date();
            const timeEl = document.getElementById('clock-time');
            const dateEl = document.getElementById('clock-date');
            if(timeEl) timeEl.textContent = now.toLocaleTimeString('vi-VN');
            if(dateEl) dateEl.textContent = now.toLocaleDateString('vi-VN', { weekday: 'long', day: 'numeric', month: 'long' });
        }
        
        function startCountdown() {
            let countdownSeconds = 3600; // 60 phút
            const timerElement = document.getElementById('session-timer');
            if (!timerElement.intervalId) { // Chỉ bắt đầu nếu chưa chạy
                timerElement.intervalId = setInterval(() => {
                    countdownSeconds--;
                    const minutes = Math.floor(countdownSeconds / 60);
                    const seconds = countdownSeconds % 60;
                    timerElement.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                    if (countdownSeconds <= 0) {
                        clearInterval(timerElement.intervalId);
                        alert('Phiên làm việc đã hết hạn.');
                        window.location.reload();
                    }
                }, 1000);
            }
        }

        // --- GÁN SỰ KIỆN ---
        renderLeftMenu();
        renderRightMenu();
        
        leftSidebarContainer.addEventListener('mouseenter', () => { clearTimeout(leftSidebarTimeout); expandSidebar(leftSidebarContainer); });
        leftSidebarContainer.addEventListener('mouseleave', () => { leftSidebarTimeout = setTimeout(() => collapseSidebar(leftSidebarContainer), HIDE_DELAY); });
        rightSidebarContainer.addEventListener('mouseenter', () => { clearTimeout(rightSidebarTimeout); expandSidebar(rightSidebarContainer); });
        rightSidebarContainer.addEventListener('mouseleave', () => { rightSidebarTimeout = setTimeout(() => collapseSidebar(rightSidebarContainer), HIDE_DELAY); });
        
        document.getElementById('btnGoHomeHeader').addEventListener('click', () => loadContent('TRANG CHỦ - THÔNG BÁO'));
        
        // Admin Login Events
        adminLoginSubmit.addEventListener('click', handleAdminLogin);
        adminLoginCancel.addEventListener('click', () => { adminLoginModal.style.display = 'none'; });
        adminPassword.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleAdminLogin(); });

        // Logout Events
        document.getElementById('logoutButton').addEventListener('click', () => { customConfirmModal.style.display = 'flex'; });
        document.getElementById('confirmBtnNo').addEventListener('click', () => { customConfirmModal.style.display = 'none'; });
        document.getElementById('confirmBtnYes').addEventListener('click', () => {
            // Trên GitHub Pages, "đăng xuất" chỉ đơn giản là tải lại trang
            window.location.reload();
        });
        
        // Support Popup Events
        const supportBtn = document.getElementById('supportContactButton');
        const supportPopup = document.getElementById('supportContactPopup');
        supportBtn.addEventListener('click', () => supportPopup.classList.toggle('show'));
        document.getElementById('closeSupportPopup').addEventListener('click', () => supportPopup.classList.remove('show'));
        document.addEventListener('click', (e) => {
            if (!supportPopup.contains(e.target) && !supportBtn.contains(e.target)) {
                supportPopup.classList.remove('show');
            }
        });
        
        // --- KHỞI CHẠY ---
        updateClock();
        setInterval(updateClock, 1000);
        
        // Bắt đầu đếm ngược phiên làm việc khi có tương tác
        ['load', 'mousemove', 'mousedown', 'touchstart', 'click', 'keydown', 'scroll'].forEach(evt => {
            window.addEventListener(evt, startCountdown, { once: true });
        });
    });
    </script>
</body>
</html>
