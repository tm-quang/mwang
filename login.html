<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập | Đăng ký</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #0056b3;
            --secondary-color: #007bff;
            --text-color: #333;
            --white-color: #fff;
            --border-color: #ddd;
            --error-color: #dc3545;
            --success-color: #28a745;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            /* NỀN MỚI HÀI HÒA HƠN */
            background: linear-gradient(-45deg, #23a6d5, #23d5ab, #5b23d5, #007bff);
            background-size: 400% 400%;
            animation: gradient-animation 15s ease infinite;
        }

        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .main-container {
            display: flex;
            width: 100%;
            max-width: 1100px;
            min-height: 650px;
            background-color: var(--white-color);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            animation: fadeIn 0.8s ease-in-out;
            position: relative;
            z-index: 10;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .info-panel {
            flex: 2.5;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: var(--white-color);
            padding: 50px;
            display: flex;
            flex-direction: column;
            //justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .info-panel h2 { font-size: 2.0rem; margin-bottom: 10px; z-index: 2; }
        .info-panel p { font-size: 1.1rem; line-height: 1.6; z-index: 2; }

        .waves { position: absolute; width: 100%; height: 15rem; bottom: 0; left: 0; z-index: 1; }
        .parallax > use { animation: move-forever 25s cubic-bezier(.55,.5,.45,.5) infinite; }
        .parallax > use:nth-child(1) { animation-delay: -2s; animation-duration: 7s; }
        .parallax > use:nth-child(2) { animation-delay: -3s; animation-duration: 10s; }
        .parallax > use:nth-child(3) { animation-delay: -4s; animation-duration: 13s; }
        .parallax > use:nth-child(4) { animation-delay: -5s; animation-duration: 20s; }
        @keyframes move-forever { 0% { transform: translate3d(-90px,0,0); } 100% { transform: translate3d(85px,0,0); } }
        
        .form-panel { flex: 1.5; padding: 20px 50px; display: flex; justify-content: center; align-items: center; }
        .form-wrapper { width: 100%; max-width: 400px; }
        .logo { text-align: center; margin-bottom: 20px; }
        .logo i { font-size: 4rem; color: var(--secondary-color); }
        .tab-buttons { display: flex; justify-content: center; margin-bottom: 25px; background: #e9ecef; border-radius: 50px; padding: 5px; }
        .tab-button { background: none; border: none; padding: 10px 20px; font-size: 1em; font-weight: 600; color: #555; cursor: pointer; transition: all 0.3s ease; flex: 1; text-align: center; border-radius: 50px; }
        .tab-button.active { background-color: var(--white-color); color: var(--primary-color); box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 20px; position: relative; }
        .form-group i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #aaa; transition: color 0.3s ease; }
        .form-group input { width: 100%; padding: 14px 14px 14px 45px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1em; font-family: 'Poppins', sans-serif; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
        .form-group input:focus { border-color: var(--secondary-color); outline: none; box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2); }
        .form-group input:focus + i { color: var(--secondary-color); }
        
        /* --- HIỆU ỨNG NÚT BẤM NÂNG CẤP --- */
        .btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white; padding: 14px 25px; border: none; border-radius: 8px;
            font-size: 1.1em; cursor: pointer;
            width: 100%; font-weight: 600; box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
            position: relative;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.6s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }
        .btn:hover::before {
            left: 100%;
        }
        /* --- CSS CHO NHÓM NÚT VÀ NÚT XÓA --- */
.button-group {
    display: flex;
    gap: 10px; /* Tạo khoảng cách giữa các nút */
}

.btn.btn-clear {
    background: var(--error-color); /* Sử dụng màu đỏ đã định nghĩa */
    box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
}

.btn.btn-clear:hover {
    background: #c82333; /* Màu đỏ đậm hơn khi di chuột */
    box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
}

/* Loại bỏ hiệu ứng vệt sáng cho nút xóa để không bị rối */
.btn.btn-clear::before {
    display: true;
}
/* --- CSS CHO LOGO BÊN TRÁI --- */
.info-panel-logo {
    text-align: center; /* Căn giữa logo */
    margin-bottom: 60px; /* Tạo khoảng cách với dòng chữ bên dưới */
    margin-top: 5px;
}

.info-panel-logo img {
    /* TÙY CHỈNH KÍCH THƯỚC LOGO TẠI ĐÂY 
    */
    max-width: 150px;  /* Chiều rộng tối đa của logo */
    height: auto;      /* Chiều cao tự động theo tỉ lệ */
}
        .tab-content { display: none; animation: fade-in-form 0.5s ease-in-out; }
        @keyframes fade-in-form { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-content.active { display: block; }
        
        #loadingIndicator { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.8); justify-content: center; align-items: center; z-index: 2000; }
        .spinner { border: 8px solid #f3f3f3; border-top: 8px solid var(--secondary-color); border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .popup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 1500; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.3s ease-in-out; }
        .popup-overlay.show { opacity: 1; pointer-events: auto; }
        .popup-container { background: var(--white-color); color: var(--text-color); padding: 30px 40px; border-radius: 12px; box-shadow: 0 5px 25px rgba(0,0,0,0.2); text-align: center; width: 90%; max-width: 380px; transform: scale(0.9); transition: transform 0.3s ease-in-out; }
        .popup-overlay.show .popup-container { transform: scale(1); }
        .popup-icon { font-size: 4rem; margin-bottom: 15px; }
        .popup-container.success .popup-icon { color: var(--success-color); }
        .popup-container.error .popup-icon { color: var(--error-color); }
        .popup-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 10px; }
        .popup-message { font-size: 1rem; color: #666; margin-bottom: 25px; }
        .popup-close-btn { background: var(--secondary-color); color: white; padding: 10px 30px; border: none; border-radius: 6px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s; }
        .popup-close-btn:hover { background: var(--primary-color); }

        #errorAlert { position: fixed; bottom: 20px; right: 20px; background-color: var(--error-color); color: var(--white-color); padding: 15px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 10px; z-index: 1600; opacity: 0; transform: translateX(calc(100% + 20px)); transition: opacity 0.4s ease, transform 0.4s ease; }
        #errorAlert.show { opacity: 1; transform: translateX(0); }
        #errorAlert i { font-size: 1.2rem; }

        .support-widget { position: fixed; bottom: 20px; right: 20px; z-index: 100; transition: z-index 0.1s linear; }
        .support-bubble { width: 60px; height: 60px; background: var(--secondary-color); color: var(--white-color); border-radius: 50%; border: none; display: flex; justify-content: center; align-items: center; font-size: 1.8rem; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: transform 0.2s ease, background-color 0.2s ease; }
        .support-bubble:hover { transform: scale(1.1); background-color: var(--primary-color); }
        .support-info-box { position: absolute; bottom: 75px; right: 0; width: 300px; background: var(--white-color); color: var(--text-color); border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); padding: 15px; opacity: 0; transform: translateY(10px); pointer-events: none; transition: opacity 0.3s ease, transform 0.3s ease; }
        .support-widget.open .support-info-box { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .support-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 10px; }
        .support-header h4 { font-size: 1.1rem; font-weight: 600; }
        .close-support-btn { background: none; border: none; font-size: 1.5rem; color: #aaa; cursor: pointer; line-height: 1; }
        .support-body a { color: var(--secondary-color); text-decoration: none; font-weight: 600; }
        .support-body p { margin-bottom: 5px; }

        @media (max-width: 992px) { /* Giữ nguyên */ }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="info-panel">
            <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
                <defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" /></defs>
                <g class="parallax">
                    <use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(255,255,255,0.7)" />
                    <use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.5)" />
                    <use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.3)" />
                    <use xlink:href="#gentle-wave" x="48" y="7" fill="#fff" />
                </g>
            </svg>
            <div class="info-panel-logo">
                <img src="https://cdn.haitrieu.com/wp-content/uploads/2021/11/Logo-The-Gioi-Di-Dong-MWG.png" alt="Logo">
            </div>
            <h2>Chào mừng bạn!</h2>
            <p>Đăng nhập để tiếp tục truy cập vào hệ thống và quản lý công việc của bạn một cách hiệu quả nhất.</p>
        </div>
        <div class="form-panel">
            <div class="form-wrapper">
                <div class="logo">
                    <i class="fa-solid fa-shield-halved"></i>
                </div>
                <div class="tab-buttons">
                    <button class="tab-button active" id="login-tab-button" onclick="showTab('login')">Đăng nhập</button>
                    <button class="tab-button" id="signup-tab-button" onclick="showTab('signup')">Đăng ký</button>
                </div>
                <div id="loginTab" class="tab-content active">
                    <form id="loginForm" onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <input type="text" id="loginUsername" name="username" required placeholder="Tên đăng nhập">
                            <i class="fa-solid fa-user"></i>
                        </div>
                        <div class="form-group">
                            <input type="password" id="loginPassword" name="password" required placeholder="Mật khẩu">
                            <i class="fa-solid fa-lock"></i>
                        </div>
                        <div class="button-group">
                           <button type="submit" class="btn">Đăng nhập</button>
                          <button type="button" class="btn btn-clear" onclick="clearForm('loginForm')">Xóa</button>
                        </div>
                    </form>
                </div>
                <div id="signupTab" class="tab-content">
                    <form id="signupForm" onsubmit="handleSignup(event)">
                        <div class="form-group">
                            <input type="text" id="signupUsername" placeholder="Tên đăng nhập" name="username" required>
                            <i class="fa-solid fa-user-plus"></i>
                        </div>
                        <div class="form-group">
                            <input type="password" id="signupPassword" placeholder="Mật khẩu" name="password" required>
                            <i class="fa-solid fa-lock"></i>
                        </div>
                        <div class="form-group">
                            <input type="password" id="signupConfirmPassword" placeholder="Xác nhận mật khẩu" required>
                            <i class="fa-solid fa-key"></i>
                        </div>
                        <div class="form-group">
                            <input type="text" id="signupFullName" placeholder="Tên đầy đủ của bạn" name="fullName" required>
                            <i class="fa-solid fa-id-card"></i>
                        </div>
                        <div class="form-group">
                            <input type="tel" id="signupPhone" placeholder="Số điện thoại" name="phone" required>
                            <i class="fa-solid fa-phone"></i>
                        </div>
                        <div class="button-group">
    <button type="submit" class="btn">Đăng ký</button>
    <button type="button" class="btn btn-clear" onclick="clearForm('signupForm')">Xóa</button>
</div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <div id="popupOverlay" class="popup-overlay">
        <div id="popupContainer" class="popup-container">
            <div id="popupIcon" class="popup-icon"></div>
            <h3 id="popupTitle" class="popup-title"></h3>
            <p id="popupMessage" class="popup-message"></p>
            <button id="popupCloseBtn" class="popup-close-btn">Đóng</button>
        </div>
    </div>
    <div id="errorAlert">
        <i class="fas fa-exclamation-circle"></i>
        <span id="errorAlertMessage"></span>
    </div>
    <div class="support-widget" id="supportWidget">
        <div class="support-info-box" id="supportInfoBox">
            <div class="support-header">
                <h4>Liên Hệ Hỗ Trợ:</h4>
                <button class="close-support-btn" id="closeSupportBox">&times;</button>
            </div>
            <div class="support-body">
                <p>112080 - Trần Minh Quang</p>
                <a href="mailto:minhquang030@gmail.com">minhquang030@gmail.com</a>
                <p style="margin-top: 10px;">Hotline:</p>
                <strong>0933960788</strong>
            </div>
        </div>
        <button class="support-bubble" id="supportBubble">
            <i class="fas fa-headset"></i>
        </button>
    </div>

    <div id="loadingIndicator"><div class="spinner"></div></div>

<script>
    // --- SCRIPT CHÍNH ---
    document.addEventListener('DOMContentLoaded', () => {
        showTab('login');
        
        // Logic đóng Popup trung tâm
        const popupOverlay = document.getElementById('popupOverlay');
        popupOverlay.addEventListener('click', (event) => {
            if (event.target === popupOverlay) { hidePopup(); }
        });
        document.getElementById('popupCloseBtn').addEventListener('click', hidePopup);

        // Logic cho Widget Hỗ trợ
        const supportWidget = document.getElementById('supportWidget');
        const supportBubble = document.getElementById('supportBubble');
        supportBubble.addEventListener('click', (event) => {
            event.stopPropagation(); 
            supportWidget.classList.toggle('open');
        });
        document.getElementById('closeSupportBox').addEventListener('click', () => {
            supportWidget.classList.remove('open');
        });
        window.addEventListener('click', () => {
            if (supportWidget.classList.contains('open')) {
                supportWidget.classList.remove('open');
            }
        });
    });

    // --- CÁC HÀM TIỆN ÍCH VÀ XỬ LÝ FORM ---
    
    // HÀM POPUP ĐÃ ĐƯỢC NÂNG CẤP
    function showPopup(titleText, messageText, type) {
        const overlay = document.getElementById('popupOverlay');
        const container = document.getElementById('popupContainer');
        const icon = document.getElementById('popupIcon');
        const title = document.getElementById('popupTitle');
        const msg = document.getElementById('popupMessage');
        
        // Nâng widget hỗ trợ lên trên lớp phủ
        document.getElementById('supportWidget').style.zIndex = '1501';
        
        title.textContent = titleText; // Sử dụng tiêu đề được truyền vào
        msg.textContent = messageText; // Sử dụng nội dung được truyền vào

        if (type === 'success') {
            container.className = 'popup-container success';
            icon.innerHTML = '<i class="fas fa-check-circle"></i>';
        } else { // type === 'error'
            container.className = 'popup-container error';
            icon.innerHTML = '<i class="fas fa-times-circle"></i>';
        }
        overlay.classList.add('show');
    }

    function hidePopup() {
        document.getElementById('popupOverlay').classList.remove('show');
        // Hạ widget hỗ trợ về vị trí cũ
        document.getElementById('supportWidget').style.zIndex = '100';
    }
    
    let errorAlertTimeout;
    function showErrorAlert(message) {
        const alertBox = document.getElementById('errorAlert');
        document.getElementById('errorAlertMessage').textContent = message;
        alertBox.classList.add('show');
        clearTimeout(errorAlertTimeout);
        errorAlertTimeout = setTimeout(() => {
            alertBox.classList.remove('show');
        }, 4000);
    }

    function showTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
        document.getElementById(tabName + 'Tab').classList.add('active');
        document.getElementById(tabName + '-tab-button').classList.add('active');
    }

    function showLoadingIndicator() { document.getElementById('loadingIndicator').style.display = 'flex'; }
    function hideLoadingIndicator() { document.getElementById('loadingIndicator').style.display = 'none'; }
    function clearForm(formId) {
            const form = document.getElementById(formId);
            if (form) {
                form.reset(); // Phương thức reset() có sẵn để xóa mọi ô input trong form
            }
        }
    // HÀM LOGIN ĐÃ CẬP NHẬT LỜI GỌI POPUP
    function handleLogin(event) {
        event.preventDefault();
        showLoadingIndicator();
        const username = document.getElementById('loginUsername').value;
        const password = document.getElementById('loginPassword').value;
        google.script.run
            .withSuccessHandler(response => {
                hideLoadingIndicator();
                if (response.success) {
                    showPopup('Đăng nhập thành công!', response.message, 'success');
                    document.getElementById('popupCloseBtn').onclick = () => {
                        hidePopup();
                        google.script.run.withSuccessHandler(url => { window.top.location.href = url; }).getWebAppUrl();
                    };
                } else {
                    showErrorAlert(response.message);
                }
            })
            .withFailureHandler(error => {
                hideLoadingIndicator();
                showPopup('Lỗi hệ thống', error.message, 'error');
            })
            .handleLogin(username, password);
    }

    // HÀM SIGNUP ĐÃ CẬP NHẬT LỜI GỌI POPUP
    function handleSignup(event) {
            event.preventDefault();
            
            // Lấy giá trị từ các ô input
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            
            // --- LOGIC KIỂM TRA MẬT KHẨU MỚI ---
            if (password !== confirmPassword) {
                showErrorAlert('Mật khẩu xác nhận không khớp!');
                return; // Dừng hàm tại đây nếu mật khẩu không khớp
            }
            // --- KẾT THÚC LOGIC MỚI ---

            showLoadingIndicator();
            const username = document.getElementById('signupUsername').value;
            const fullName = document.getElementById('signupFullName').value;
            const phone = document.getElementById('signupPhone').value;
            
            google.script.run
                .withSuccessHandler(response => {
                    hideLoadingIndicator();
                    if (response.success) {
                        document.getElementById('signupForm').reset();
                        showPopup('Đăng ký thành công!', response.message, 'success');
                        document.getElementById('popupCloseBtn').onclick = () => {
                            hidePopup();
                            document.getElementById('login-tab-button').click();
                        };
                    } else {
                        showPopup('Đăng ký thất bại', response.message, 'error');
                    }
                })
                .withFailureHandler(error => {
                    hideLoadingIndicator();
                    showPopup('Lỗi hệ thống', error.message, 'error');
                })
                .handleRegister(username, password, fullName, phone);
        }
</script>
</body>
</html>